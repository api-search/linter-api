"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.bundleRuleset = void 0;
const rollup_1 = require("rollup");
const path_1 = require("@stoplight/path");
const isPackageImport_1 = require("./utils/isPackageImport");
async function bundleRuleset(input, { target = 'browser', plugins, format, treeshake = false }) {
    const bundle = await (0, rollup_1.rollup)({
        input,
        plugins,
        treeshake,
        watch: false,
        perf: false,
        onwarn(e, fn) {
            if (e.code === 'MISSING_NAME_OPTION_FOR_IIFE_EXPORT') {
                return;
            }
            fn(e);
        },
        external: target === 'runtime'
            ? []
            : target === 'browser'
                ? id => (0, path_1.isURL)(id)
                : (id, importer) => id.startsWith('node:') || (!(0, path_1.isURL)(id) && (0, isPackageImport_1.isPackageImport)(id) && (importer === void 0 || !(0, path_1.isURL)(importer))),
    });
    return (await bundle.generate({ format: format !== null && format !== void 0 ? format : (target === 'runtime' ? 'iife' : 'esm'), exports: 'auto' }))
        .output[0].code;
}
exports.bundleRuleset = bundleRuleset;
//# sourceMappingURL=index.js.map