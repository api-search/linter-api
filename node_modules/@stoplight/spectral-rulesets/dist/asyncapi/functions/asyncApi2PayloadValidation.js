"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ajv_1 = require("ajv");
const ajv_formats_1 = require("ajv-formats");
const spectral_core_1 = require("@stoplight/spectral-core");
const betterAjvErrors = require("@stoplight/better-ajv-errors");
const asyncApi2Schema = require("../schemas/schema.asyncapi2.json");
const fakeSchemaObjectId = 'asyncapi2#/definitions/schema';
const asyncApi2SchemaObject = { $ref: fakeSchemaObjectId };
const ajv = new ajv_1.default({
    allErrors: true,
    strict: false,
});
(0, ajv_formats_1.default)(ajv);
ajv.addSchema(asyncApi2Schema, asyncApi2Schema.$id);
const ajvValidationFn = ajv.compile(asyncApi2SchemaObject);
exports.default = (0, spectral_core_1.createRulesetFunction)({
    input: null,
    options: null,
}, function asyncApi2PayloadValidation(targetVal, _opts, context) {
    ajvValidationFn(targetVal);
    return betterAjvErrors(asyncApi2SchemaObject, ajvValidationFn.errors, {
        propertyPath: context.path,
        targetValue: targetVal,
    }).map(({ suggestion, error, path: errorPath }) => ({
        message: suggestion !== void 0 ? `${error}. ${suggestion}` : error,
        path: [...context.path, ...(errorPath !== '' ? errorPath.replace(/^\//, '').split('/') : [])],
    }));
});
//# sourceMappingURL=asyncApi2PayloadValidation.js.map